<!-- ===========================
FILE: index.html
=========================== -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ARES // GRID ACCESS</title>

<style>
:root{
  --bg:#020409;
  --cyan:#00e5ff;
  --amber:#ffcc66;
  --red:#ff3b3b;
  --ok:#66ffcc;
  --panel:rgba(0,20,30,.62);
  --line:rgba(0,229,255,.18);
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:
    radial-gradient(900px 600px at 50% 20%, rgba(0,229,255,.08), transparent 60%),
    radial-gradient(900px 600px at 20% 80%, rgba(255,59,59,.05), transparent 55%),
    linear-gradient(180deg, #01020a, #020409 40%, #01020a);
  color:var(--cyan);
  font-family:var(--mono);
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  padding:18px;
  overflow:hidden;
}

/* subtle grid */
body:before{
  content:"";
  position:fixed; inset:0;
  background:
    linear-gradient(var(--line) 1px, transparent 1px),
    linear-gradient(90deg, var(--line) 1px, transparent 1px);
  background-size:64px 64px;
  opacity:.14;
  pointer-events:none;
}

/* scanlines */
body:after{
  content:"";
  position:fixed; inset:-30%;
  background:linear-gradient(transparent 0 49%, rgba(0,0,0,.18) 50% 51%, transparent 52% 100%);
  background-size:100% 6px;
  opacity:.12;
  pointer-events:none;
  animation:scan 6s linear infinite;
}
@keyframes scan { to{ transform:translateY(120px);} }

.container{
  width:92%;
  max-width:900px;
  border:1px solid rgba(0,229,255,.4);
  padding:18px 18px 16px;
  background:var(--panel);
  box-shadow:0 0 50px rgba(0,229,255,.18);
  border-radius:14px;
  position:relative;
}

/* top bar */
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 12px;
  border:1px solid rgba(0,229,255,.18);
  border-radius:12px;
  background:rgba(0,0,0,.18);
  margin-bottom:14px;
}
.badge{
  display:flex; gap:10px; align-items:center;
  letter-spacing:.18em;
  text-transform:uppercase;
  font-size:12px;
  color:rgba(191,233,255,.8);
}
.dot{
  width:10px;height:10px;border-radius:50%;
  background:rgba(0,229,255,.55);
  box-shadow:0 0 14px rgba(0,229,255,.35);
}
.clock{
  font-size:12px;
  letter-spacing:.14em;
  text-transform:uppercase;
  color:rgba(191,233,255,.65);
}

h1{
  margin:0;
  font-size:15px;
  letter-spacing:.18em;
  text-transform:uppercase;
}

/* boot log */
.log{
  height:220px;
  overflow:hidden;
  white-space:pre-wrap;
  font-size:12px;
  margin-top:12px;
  border:1px solid rgba(0,229,255,.16);
  border-radius:12px;
  padding:12px;
  background:rgba(0,0,0,.18);
  box-shadow:inset 0 0 20px rgba(0,229,255,.06);
}
.cursor{
  display:inline-block;
  width:8px;height:14px;
  background:rgba(0,229,255,.7);
  margin-left:6px;
  vertical-align:-2px;
  animation:blink 1s steps(2,end) infinite;
  box-shadow:0 0 10px rgba(0,229,255,.35);
}
@keyframes blink{ 50%{opacity:0;} }

.hidden{display:none;}

.override{
  color:var(--amber);
  margin-top:10px;
  line-height:1.65;
  font-size:14px;
}

.sub{
  margin-top:10px;
  color:rgba(191,233,255,.72);
  font-size:12px;
  letter-spacing:.08em;
  text-transform:uppercase;
}

/* auth window + decay bar */
.timerRow{
  margin-top:12px;
  display:flex;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  color:rgba(191,233,255,.75);
  font-size:12px;
  letter-spacing:.08em;
  text-transform:uppercase;
}
.tag{
  padding:4px 10px;
  border-radius:999px;
  border:1px solid rgba(0,229,255,.22);
  background:rgba(0,229,255,.06);
  color:rgba(191,233,255,.8);
  font-size:11px;
  letter-spacing:.12em;
  text-transform:uppercase;
}
.tag.amber{ border-color:rgba(255,204,102,.35); background:rgba(255,204,102,.08); color:rgba(255,244,220,.95); }
.tag.red{ border-color:rgba(255,59,59,.35); background:rgba(255,59,59,.08); color:rgba(255,190,190,.95); }

.meter{
  margin-top:10px;
  height:12px;
  border-radius:999px;
  border:1px solid rgba(0,229,255,.16);
  background:rgba(0,0,0,.22);
  overflow:hidden;
}
.meterFill{
  height:100%;
  width:100%;
  background:linear-gradient(90deg, rgba(0,229,255,.75), rgba(0,229,255,.25));
  transition:width .35s ease, background .35s ease;
}

/* buttons */
.btnRow{
  margin-top:14px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
button{
  padding:10px 14px;
  border-radius:12px;
  border:1px solid rgba(0,229,255,.35);
  background:rgba(0,229,255,.06);
  color:rgba(191,233,255,.92);
  cursor:pointer;
  letter-spacing:.14em;
  text-transform:uppercase;
  font-family:var(--mono);
  font-size:12px;
}
button:hover{ background:rgba(0,229,255,.14); }
button:active{ transform:translateY(1px); }
button.deny{
  border-color:rgba(255,59,59,.35);
  background:rgba(255,59,59,.07);
}
button.deny:hover{
  background:rgba(255,59,59,.12);
}
button[disabled]{
  opacity:.55;
  cursor:not-allowed;
}

.result{
  margin-top:14px;
  border:1px solid rgba(0,229,255,.16);
  border-radius:12px;
  padding:12px;
  background:rgba(0,0,0,.16);
  font-size:13px;
  line-height:1.55;
}
.success{color:var(--ok);}
.danger{color:var(--red);}

/* CM callout */
.callout{
  margin-top:14px;
  padding:14px;
  border-radius:12px;
  border:1px solid rgba(255,204,102,.26);
  background:linear-gradient(180deg, rgba(255,204,102,.08), rgba(0,0,0,.10));
  box-shadow:inset 0 0 0 1px rgba(255,204,102,.06);
}
.callout strong{
  color:rgba(255,204,102,.95);
  letter-spacing:.14em;
  text-transform:uppercase;
  font-size:12px;
}
.callout .line{
  margin-top:8px;
  color:rgba(255,244,220,.95);
  font-size:14px;
}

/* GLITCH flicker overlay */
#glitchFx{
  position:fixed; inset:0;
  pointer-events:none;
  opacity:0;
  mix-blend-mode:screen;
  background:
    linear-gradient(90deg, rgba(255,59,59,.08), rgba(0,229,255,.10), rgba(255,204,102,.06)),
    radial-gradient(900px 600px at 50% 30%, rgba(0,229,255,.12), transparent 65%);
  filter:contrast(1.2) saturate(1.2);
}
.flicker #glitchFx{
  opacity:1;
  animation:flicker .16s steps(2,end) infinite;
}
@keyframes flicker{
  0%{ transform:translate(0,0); filter:hue-rotate(0deg) contrast(1.1); }
  25%{ transform:translate(2px,-1px); filter:hue-rotate(12deg) contrast(1.35); }
  50%{ transform:translate(-3px,2px); filter:hue-rotate(-10deg) contrast(1.55); }
  75%{ transform:translate(1px,3px); filter:hue-rotate(8deg) contrast(1.3); }
  100%{ transform:translate(0,0); filter:hue-rotate(0deg) contrast(1.1); }
}

/* extra glitch intensity for denial/malware */
.hardflicker #glitchFx{
  opacity:1;
  animation:flicker .09s steps(2,end) infinite;
}

/* subtle shake on denial/malware */
@keyframes shake{
  0%{transform:translate(0,0)}
  20%{transform:translate(2px,0)}
  40%{transform:translate(-2px,1px)}
  60%{transform:translate(2px,1px)}
  80%{transform:translate(-2px,0)}
  100%{transform:translate(0,0)}
}
.shake .container{ animation:shake .22s steps(2,end) 8; }
</style>
</head>

<body>
<div id="glitchFx"></div>

<div class="container">
  <div class="topbar">
    <div class="badge"><span class="dot"></span>ARES // GRID ACCESS TERMINAL</div>
    <div class="clock" id="clock">SYNC: --:--:--</div>
  </div>

  <!-- BOOT -->
  <div id="boot">
    <h1>Hacked Boot Sequence</h1>
    <div class="sub">tap once anywhere to arm audio // then proceed</div>
    <div class="log"><span id="log"></span><span class="cursor"></span></div>
  </div>

  <!-- OVERRIDE -->
  <div id="override" class="hidden">
    <h1>Arena Intake Authorization</h1>
    <div class="sub">Greetings, User. // End of Line.</div>

    <div class="override">
      ARES OVERRIDE // ARENA INTAKE PRIORITY 01<br>
      NON-COMPLIANT SUBJECTS DETECTED<br>
      REQUEST EXPEDITED ARENA INTAKE<br>
      AWAITING GRID AUTHORIZATION
    </div>

    <div class="timerRow">
      <div>authorization window: <span id="timeLeft">45</span>s</div>
      <div class="tag" id="stateTag">stable</div>
    </div>

    <div class="meter" aria-label="authorization decay bar">
      <div class="meterFill" id="meterFill"></div>
    </div>

    <div class="callout">
      <strong>Cast Member Confirmation</strong>
      <div class="line" id="cmLine">(CM: QUORRA) Prisoners, scan identity disk to confirm custody transfer.</div>
    </div>

    <div class="btnRow">
      <button id="grantBtn" type="button">ACCESS GRANTED</button>
      <button id="denyBtn" class="deny" type="button">ACCESS DENIED</button>
    </div>

    <div class="sub" id="clickHint">
      CM CONFIRMATION REQUIRED // GRANT: 0/3 • DENY: 0/3
    </div>

    <div id="result" class="result hidden"></div>
  </div>
</div>

<script>
/* ----------------- CLOCK ----------------- */
const clockEl = document.getElementById("clock");
function tick(){
  const d = new Date();
  const pad = n => String(n).padStart(2,'0');
  clockEl.textContent = `SYNC: ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
}
setInterval(tick, 500); tick();

/* ----------------- AUDIO (WebAudio) -----------------
   Browsers require a user gesture (tap/click) to start audio.
*/
let audioCtx = null;
let primed = false;

function primeAudio(){
  if(primed) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  primed = true;
}

document.addEventListener("pointerdown", () => primeAudio(), { once:true });

function tronChirp(){
  if(!primed) return;
  const t0 = audioCtx.currentTime;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = "sawtooth";
  o.frequency.setValueAtTime(220, t0);
  o.frequency.exponentialRampToValueAtTime(880, t0 + 0.12);
  o.frequency.exponentialRampToValueAtTime(330, t0 + 0.22);
  g.gain.setValueAtTime(0.0001, t0);
  g.gain.exponentialRampToValueAtTime(0.12, t0 + 0.02);
  g.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.28);
  o.connect(g).connect(audioCtx.destination);
  o.start(t0);
  o.stop(t0 + 0.30);
}

function warningBeep(){
  if(!primed) return;
  const t0 = audioCtx.currentTime;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = "sine";
  o.frequency.setValueAtTime(660, t0);
  g.gain.setValueAtTime(0.0001, t0);
  g.gain.exponentialRampToValueAtTime(0.08, t0 + 0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.10);
  o.connect(g).connect(audioCtx.destination);
  o.start(t0);
  o.stop(t0 + 0.11);
}

function malwareBuzz(){
  if(!primed) return;
  const t0 = audioCtx.currentTime;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = "square";
  o.frequency.setValueAtTime(95, t0);
  o.frequency.linearRampToValueAtTime(55, t0 + 0.35);
  g.gain.setValueAtTime(0.0001, t0);
  g.gain.exponentialRampToValueAtTime(0.18, t0 + 0.03);
  g.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.45);
  o.connect(g).connect(audioCtx.destination);
  o.start(t0);
  o.stop(t0 + 0.48);
}

/* ----------------- GLITCH HELPERS ----------------- */
function glitchSoft(ms=650){
  document.body.classList.add("flicker");
  setTimeout(()=>document.body.classList.remove("flicker"), ms);
}
function glitchHard(ms=1200){
  document.body.classList.add("hardflicker","shake");
  setTimeout(()=>document.body.classList.remove("hardflicker","shake"), ms);
}

/* ----------------- BOOT SEQUENCE ----------------- */
const logEl = document.getElementById("log");
const bootLines = [
  "INIT // ARES.NODE.BOOTSTRAP()",
  "LINK // GRID.TRANSPORT.BUS // OK",
  "CHECK // IDENTITY_DISK.READER // ONLINE",
  "VERIFY // MCP.AUTHORITY // SPOOFED",
  "WARN // UNAUTHORIZED SIGNAL DETECTED",
  "INJECT // OVERRIDE PAYLOAD // ARES-INTAKE-01",
  "BYPASS // QUEUE.GATEKEEPER // SUCCESS",
  "SCAN // SUBJECTS // NON-COMPLIANT",
  "ROUTE // LIGHTCYCLE.RUN ACCESS CHANNEL // NEGOTIATING",
  "REQUEST // GRID AUTHORIZATION // PENDING",
  "EOL // END OF LINE."
];

let bootIndex = 0;
function appendBootLine(txt){
  logEl.textContent += (logEl.textContent ? "\n" : "") + txt;
  const arr = logEl.textContent.split("\n");
  if(arr.length > 16){
    logEl.textContent = arr.slice(arr.length - 16).join("\n");
  }
}

function runBoot(){
  const interval = setInterval(()=>{
    appendBootLine(bootLines[bootIndex % bootLines.length]);
    bootIndex++;
    if(bootIndex === 7){ glitchSoft(500); }
    if(bootIndex >= bootLines.length){
      clearInterval(interval);
      glitchSoft(750);
      setTimeout(showOverride, 650);
    }
  }, 520);
}
runBoot();

function showOverride(){
  document.getElementById("boot").classList.add("hidden");
  document.getElementById("override").classList.remove("hidden");
  startAuthWindow();
}

/* ----------------- AUTH WINDOW + DECAY ----------------- */
const totalSeconds = 45;
let timeLeft = totalSeconds;
let timerInterval = null;
let resolved = false;

const timeLeftEl = document.getElementById("timeLeft");
const meterFill = document.getElementById("meterFill");
const stateTag = document.getElementById("stateTag");
const resultEl = document.getElementById("result");

function setState(mode){
  if(mode === "stable"){
    stateTag.className = "tag";
    stateTag.textContent = "stable";
    meterFill.style.background = "linear-gradient(90deg, rgba(0,229,255,.75), rgba(0,229,255,.25))";
  } else if(mode === "warning"){
    stateTag.className = "tag amber";
    stateTag.textContent = "warning";
    meterFill.style.background = "linear-gradient(90deg, rgba(255,204,102,.95), rgba(255,204,102,.35))";
  } else if(mode === "critical"){
    stateTag.className = "tag red";
    stateTag.textContent = "critical";
    meterFill.style.background = "linear-gradient(90deg, rgba(255,59,59,.95), rgba(255,59,59,.35))";
  }
}

function updateDecayUI(){
  timeLeftEl.textContent = String(timeLeft);
  const pct = Math.max(0, Math.min(100, (timeLeft / totalSeconds) * 100));
  meterFill.style.width = pct + "%";

  if(timeLeft <= 10){
    setState("critical");
  } else if(timeLeft <= 18){
    setState("warning");
  } else {
    setState("stable");
  }
}

function startAuthWindow(){
  resolved = false;
  timeLeft = totalSeconds;
  updateDecayUI();

  // subtle warning beeps at 18 and 10 seconds (if audio is primed)
  let beep18 = false;
  let beep10 = false;

  timerInterval = setInterval(()=>{
    if(resolved) return;
    timeLeft--;
    if(timeLeft < 0) timeLeft = 0;
    updateDecayUI();

    if(timeLeft === 18 && !beep18){
      beep18 = true;
      glitchSoft(450);
      warningBeep();
    }
    if(timeLeft === 10 && !beep10){
      beep10 = true;
      glitchSoft(650);
      warningBeep();
      warningBeep();
    }

    if(timeLeft <= 0){
      clearInterval(timerInterval);
      malwareEvent();
    }
  }, 1000);
}

/* ----------------- BUTTONS (MULTI-CLICK CONFIRM + REDIRECT) ----------------- */
const REQUIRED_CLICKS = 3;
const CLICK_LOCK_MS = 450;

const grantBtn = document.getElementById("grantBtn");
const denyBtn  = document.getElementById("denyBtn");
const clickHint = document.getElementById("clickHint");

let grantClicks = 0;
let denyClicks = 0;

function updateClickHint(){
  if(!clickHint) return;
  clickHint.textContent = `CM CONFIRMATION REQUIRED // GRANT: ${grantClicks}/${REQUIRED_CLICKS} • DENY: ${denyClicks}/${REQUIRED_CLICKS}`;
}

function lockButtons(){
  grantBtn.disabled = true;
  denyBtn.disabled = true;
}

function routeGranted(){ window.location.href = "access-granted.html"; }
function routeDenied(){ window.location.href = "access-denied.html"; }

function tapFeedback(){
  tronChirp();
  glitchSoft(420);
}

updateClickHint();

grantBtn.addEventListener("click", ()=>{
  if(resolved) return;
  primeAudio();

  if(denyClicks > 0) denyClicks = 0;

  grantClicks++;
  updateClickHint();

  if(grantClicks < REQUIRED_CLICKS){
    tapFeedback();
    grantBtn.textContent = "CONFIRM… TAP AGAIN";
    return;
  }

  resolved = true;
  clearInterval(timerInterval);
  lockButtons();

  glitchSoft(800);
  tronChirp();

  setTimeout(routeGranted, CLICK_LOCK_MS);
});

denyBtn.addEventListener("click", ()=>{
  if(resolved) return;
  primeAudio();

  if(grantClicks > 0) grantClicks = 0;

  denyClicks++;
  updateClickHint();

  if(denyClicks < REQUIRED_CLICKS){
    glitchHard(700);
    warningBeep();
    denyBtn.textContent = "CONFIRM… TAP AGAIN";
    return;
  }

  resolved = true;
  clearInterval(timerInterval);
  lockButtons();

  glitchHard(1400);
  malwareBuzz();

  setTimeout(routeDenied, CLICK_LOCK_MS);
});

/* ----------------- MALWARE TIMEOUT ----------------- */
function malwareEvent(){
  if(resolved) return;
  resolved = true;

  clearInterval(timerInterval);
  lockButtons();
  primeAudio();

  glitchHard(1600);
  malwareBuzz();

  // cinematic beat then redirect to the "fragged" page
  setTimeout(routeDenied, 700);
}
</script>
</body>
</html>
